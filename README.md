# Ajaxpaginator плагин для CakePHP

## Инсталяция

Вы можете установить этот плагин в свое приложение CakePHP с помощью [composer](https://getcomposer.org).

Установка плагина:

```
$ sudo composer require your-name-here/ajaxpaginator
$ sudo composer dumpautoload
```

#### Инициализация

1. Вставить в шаблон страницы (с расширением "ctp") следующий код:

```php
<?php
    $this->Paginator->setTemplates([
        'nextActive' => '
        <input class="hide" value="{{url}}">' .
        '<div id="list-pag">' .
            $this->element('preloader', ['loader_id' => 'sub-loader', 'w' => 56, 'h' => 56]) .
        '</div>',
        'nextDisabled' => '',
    ]);
?>
<?= $this->Paginator->next() ?>
```

2. В шаблон, который используется при возврате AJAX-запроса, вставить:

```php
<?php
    $this->Paginator->setTemplates([
        'nextActive' => '<input class="hide" value="{{url}}">',
        'nextDisabled' => '',
    ]);
?>
<?= $this->Paginator->next() ?>
```

3. В _JavaScript_ коде для конкретной страницы инициализировать ajaxpaginator:

```js
$( '#list-pag' ).verticalPaginator({ viewLoader: 'preloader' });
```

Полный перечень настроек ajaxpaginator:

```js
@param {object} this.element
    Объект оболочки, где расположена кнопка и прелоадер.
@param {string} viewLoader
    Когда запрашивать новую страницу:
        "button-preloader" - при нажатие кнопки показывать следующую страницу;
        "preloader" - при достижение конца страницы показывать следующую страницу.
@param {int} retreat
    Добавочный отступ к расстоянию до элемента, при котором включается AJAX-код. Действует только для "viewLoader=preloader".
@param {string} paste
    Куда вставлять html код, вернувшийся от AJAX-кода:
        "before" - перед объектом this.element;
        "after" - после объекта this.element.
```

#### Описание работы

Шаблон включает в себя оболочку (this.element) внутри которой располагается труббер и кнопка. Оболочка обычно представляет собой открывающийся и закрывающийся тег <div>. Труббер, располагающийся внутри оболочки, должен иметь класс "trubber", а кнопка - класс "button-preloader". Перед или после оболочки (this.element) располагается скрытое поле, содержащее адрес AJAX-запроса, а также GET параметр "page", содержащий в свою очередь, номер запрашиваемой страницы. В зависимости от того, куда необходимо выводить полученный код от AJAX-запроса, скрытое поле необходимо располагать перед или после оболочки (this.element).

![screenshot](1.png)

После получения ответа от сервера скрытое поле будет заменено на html код, полученный от сервера. Поэтому необходимо следить за тем, куда будет выводиться скрытое поле: если листинг объектов будет выводится выше оболочки (this.element), необходимо, чтобы скрытое поле шло внизу листинга объектов. Такой вывод гарантирует, что скрытое поле будет расположенно перед оболочкой. Для правильной работы пагинатора необходимо следить, чтобы скрытое поле располагалось сразу перед или после оболочки (this.element). Описанный выше шаблон (см. рисунок выше) необходимо размещать на странице, где необходима пагинация. Код, который возвращается от AJAX-запроса, должен содержать только скрытое поле. Поэтому в шаблоне, который использует AJAX-запрос, необходимо генерировать только скрытое поле. Ниже показано, каким образом это реализовать.
Также необходимо отметить, что если будет использоваться режим "viewLoader=preloader", в оболочке (this.element) кнопку можно не указывать.
